{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ثبت نام در مدد</title>
    <!-- <link rel="icon" href="{% static 'panel/images/favicon.ico' %}" type="image/x-icon" /> -->
    <link href="{% static 'madadsite/css/register.css' %}" rel="stylesheet"/>
    <script src="{% static 'madadsite/js/jquery.min.js' %}"></script>
<!--         <link href="{% static 'panel/content/Animate.css' %}" rel="stylesheet"/>
    <link href="{% static 'panel/content/FontAwesome.css' %}" rel="stylesheet"/>
    <link href="{% static 'panel/content/Remodal.css' %}" rel="stylesheet"/>
    <link href="{% static 'panel/content/QuestionsBank/Theme/Core.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'panel/content/PersianDatepicker.css' %}" rel="stylesheet"/>
    <link href="{% static 'panel/content/Select2.css' %}" rel="stylesheet"/>
    <link href="{% static 'panel/content/QuestionsBank/QuestionsList/Core.css' %}" rel="stylesheet"/>
    <script src="{% static 'panel/scripts/jquery.min.js' %}"></script>
    <script src="{% static 'panel/scripts/Autocomplete.js' %}"></script> -->
  </head>
  <body>
  {% csrf_token %}
    <h1>ثبت نام در مدد</h1>
    <form id="register_form">
    
      <div class="container">
        <label><b>نام</b></label>
        <input type="text" placeholder="نام خود را وارد کنید" id="fname" required>
        <label><b>نام خانوادگی</b></label>
        <input type="text" placeholder="نام خانوادگی خود را وارد کنید" id="lname" required>
        <label><b>نام کاربری</b></label>
        <input type="text" placeholder="نام کاربری که برای ورود به سایت میخواهید استفاده کنید را وارد کنید" id="username" required>
        <label><b>نام بیمارستان</b></label>
        <input type="text" placeholder="نام بیمارستان خود را وارد کنید" id="hospital_name" required>

        <label><b>شماره تلفن</b></label>
        <input type="text" placeholder="شماره تلفن خود را وارد کنید" id="phone" required>

        <label><b>شماره موبایل</b></label>
        <input type="text" placeholder="شماره موبایل خود را وارد کنید" id="mobile" required>
        <label><b>رمز عبور</b></label>
        <input type="password" placeholder="رمز عبور خود را وارد کنید" id="psw" required>

        <label><b>تکرار رمز عبور</b></label>
        <input type="password" placeholder="تکرار رمز عبور خود را وارد کنید" id="psw_repeat" required>
        <!-- <input type="checkbox" checked="checked"> Remember me -->

        <div class="clearfix">
          <!-- <button type="button" class="cancelbtn">انصراف</button> -->
          <button type="submit" class="signupbtn">ثبت نام</button>
        </div>
      </div>
    </form>
    <script type="text/javascript">
      $(document).ready(function(){
        function isNumberKey(evt){
          var charCode = (evt.which) ? evt.which : event.keyCode;
          if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
          return true;
        }
        $("#mobile").keypress(function(evt){
          return isNumberKey(evt);
        });
        $("#phone").keypress(function(evt){
          return isNumberKey(evt);
        });
        $("#register_form").submit(function(e){
          e.defaultPrevented;
          var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
          var firstName = $("#fname").val();
          var lastName = $("#lname").val();
          var username = $("#username").val();
          var hospitalName = $("#hospital_name").val();
          var phone = $("#phone").val();
          var mobile = $("#mobile").val();
          var password = $("#psw").val();
          var passwordRepeat = $("#psw_repeat").val();
          var phoneno = /^[0][9][0-9]{9}$/;

          if(password.length<5){
            alert("لطفا رمز عبور خود را بیشتر از ۵ کاراکتر انتخاب کنید");
            return false;
          }
          if(password!=passwordRepeat){
            alert("رمز عبور و تکرار آن مطابقت ندارند!");
            return false;
          }
          if(!mobile.match(phoneno)) {
            alert("لطفا شماره همراه درست را وارد کنید");
            return false;
          }

          $.ajax({
              url : "/register/", 
              type : "POST",
              dataType: "json", 
              data : {
                first_name : firstName,
                last_name : lastName,
                username : username,
                hospital_name : hospitalName,
                phone : phone,
                mobile : mobile,
                password : password,
                csrfmiddlewaretoken: csrftoken,
              },
              success : function(json) {
                  // alert(json.done);
                if (json.done) {
                  alert("بیمارستان با موفقیت ثبت شد. لطفا برای فعال شدن دسترسی به سایت منتظر بمانید. پس از فعالسازی از طریف صفحه ورود، وارد سایت شوید و از خدمات استفاده کنید!");
                }
                if(json.error){
                  alert("این نام کاربری قبلا انتخاب شده است. لطفا با نام کاربری جدید ثبت نام کنید");
                }
              },
              error : function(xhr,errmsg,err) {
                  alert("ثبت بیمارستان با مشکل مواجه شد.");
              }
          });
          return false;
          // ajax = $.ajax({
          //   url : "/register/", 
          //   type: "post",
          //   dataType: "json", 
          //   // contentType: "application/json",
          //   data : {
          //     first_name : firstName,
          //     last_name : lastName,
          //     username : username,
          //     hospital_name : hospitalName,
          //     phone : phone,
          //     mobile : mobile,
          //     password : password,
          //     csrfmiddlewaretoken: csrftoken,
          //   },
          //   success: function (response) {
          //     alert(response);
          //     alert(response.done);
          //     if (response.done) {
          //       alert("بیمارستان با موفقیت ثبت شد. لطفا برای فعال شدن دسترسی به سایت منتظر بمانید. پس از فعالسازی از طریف صفحه ورود، وارد سایت شوید و از خدمات استفاده کنید!");
          //     }
          //     if(response.error){
          //       alert("این نام کاربری قبلا انتخاب شده است. لطفا با نام کاربری جدید ثبت نام کنید");
          //     }
          //   },
          //   error: function (jqXHR, textStatus, errorThrown) {

          //       alert("jqXHR: " + jqXHR.responseText + "\ntextStatus: " + textStatus + "\nerrorThrown: " + errorThrown);
          //   }
            // error : function(e) {
            //     alert(e.status + ": " + e.responseText);
            //     alert(e.readyState);
            // }
            // error: function (e) {
            //   alert(e);
            //   // alert("ثبت بیمارستان با مشکل مواجه شد.");
            // },
          // });

        });
      });
    </script>
  </body>
</html>